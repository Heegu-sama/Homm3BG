name: Label translation PR

on:
  pull_request_target:
    types: [opened]

permissions:
  pull-requests: write

jobs:
  label:
    runs-on: ubuntu-latest
    name: Label PR

    steps:
      - name: Set up repository
        uses: actions/checkout@v4

      - name: Label
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
          GH_TOKEN: ${{ github.token }}
        run: |
          cat << 'EOF' > matrix.json
            [
              { "prefix": "[PL]", "label": "ğŸ‡µğŸ‡± Polish"},
              { "prefix": "[ES]", "label": "ğŸ‡ªğŸ‡¸ Spanish"},
              { "prefix": "[FR]", "label": "ğŸ‡«ğŸ‡· Frnch"},
              { "prefix": "[RU]", "label": "ğŸ‡·ğŸ‡º Russian"},
              { "prefix": "[UA]", "label": "ğŸ‡ºğŸ‡¦ Ukrainian"},
              { "prefix": "[DE]", "label": "ğŸ‡©ğŸ‡ª German"},
              { "prefix": "[CS]", "label": "ğŸ‡¨ğŸ‡¿ Czech"},
              { "prefix": "[HE]", "label": "ğŸ‡®ğŸ‡± Hebrew"}
            ]
          EOF
          jq -c '.[]' matrix.json | while read -r item; do
            prefix=$(jq --raw-output '.prefix' <<< "$item")
            if [[ "${PR_TITLE^^:0:${#prefix}}" == "$prefix" ]]; then
              label=$(jq --raw-output '.label' <<< "$item")
              echo "Adding label: $label"
              gh pr edit ${{ github.event.pull_request.number }} --add-label "${label}"
              exit 0
            fi
          done
